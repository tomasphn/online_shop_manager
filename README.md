Online Shop Manager

Production enviroment:
  Ruby Version: 2.7.6
  Browser: Google Chrome Version: 108.0.5359.95  
  PostgreSQL Version: 12.2
  System: WSL2 on Windows 11

Application Description:
  This is an application to assist in managing online shops and products. You can create, view, edit, and remove any amount of shops. You must provide a name for each shop and a name, production cost, and selling price for each product. The application generates a profit margin for each product and sorts them within your shop by it. 

Installation Instructions:
  -Navigate to ls_final directory from command line

  -To install the appropriate gems, run the command: 
      bundle install

      -(note) if the bundler gem is not yet installed run the following command first: gem bundle install

  -To set up the database to be used by application:
    -Ensure that you're logged into a user with the appropriate psql priviledges

    -Ensure that psql database server is running on computer
      -Including this because on my device, I have to manually start it each time with: 
        sudo service postgresql start

    -To create the database and table info, run the following command:
      psql -d postgres < setup/schema.sql

      -(note) if an error is raised saying that the database "postgres" does not exist run the following command first, then run the earlier command again: createdb postgres
  
  -To begin the application:
    -Run the following command:
      bundle exec ruby app/shops.rb
    -From your browser, connect to "http://localhost:4567/"
      -Launch message should appear in console
      -Port number might be different, but should be displayed in launch message: "Sinatra (v1.4.8) has taken the stage on [port number]"
    
  -To log in
    -All pages of the application should require a valid log in to access, upon first connection to the application a login screen should appear
    -Currently the application is configured with only one valid user/password combination
      Username: admin
      Password: secret
  
  -To use
    -Most functionalities should be self explanatory, but for a quick run down:
      -Creating shops: "New Shop" button on the home page
      -View Shop and it's products: Click name of shop from home page
      -Edit/Rename Shop: "Rename Shop" button which is viewable on that shop's page
      -Delete Shop: "Delete Shop" button, viewable on shop's page
      -Create Product: "Add new product" button on each shop's page
      -View Product: Product info directly viewable from it's shop's page
      -Edit Product: "Edit product info" button listed below each product
      -Delete Product: "Delete product" button listed below each product
    -Other things
      -Each page (for shops and products) displays 5 results maximum
        -Next/last page buttons only generated when when there is a next/last page to navigate to
      -Profit for each product is colored based on how profitable it is (see styles.css for more details)
      -Restrictions for entry fields(shop name/product info) are not listed within application innately, but are 

Design Choices

Code organization
  File Tree
    I chose to place all the main app files into an "app" folder because I wanted a bit more organization than just having all the Sinatra files in the root directory. I originally wanted to split them even further into "model" and "controller" directories, but it was making finding the views/stylesheets/etc. a bit more complicated than I liked.

  Helper methods
    I know that this version of Sinatra is supposed to support a single file infrastructure, but I found keeping all the helper methods in the same file as the routes to be really cumbersome organization wise. I thought about redesigning my app as a modular Sinatra application, but was unsure if that would violate the rule of not using any gems not used within the course. I also liked how clean it was to just have routes and configuration within the main application file(shops.rb). 

Sorting
  Shops
    Primarily sorted by number of products in each shop, secondarily in alphabetic order. I considered sorting by overall profit, but different shops (ones that might have low individual profit for each product, but high sale volume) have different purposes. I felt that the shops with more products meant more to manage, and thus should be the most visible

  Products
    Sorted by profit. I chose not to have a secondary sort, because I felt like it was quite unlikely that two items would have the same profit. It would also have led to a bit of complication since profit isn't a field of the database, but generated by the application. I also found that the way SQL returned results led to consistent displays anyway.

Sign ins
  "check_sign_in" method
    I chose to add check_sign_in method to every route, including post routes(even though they would only be normally accessible from pages you would have to be logged in to view), just in case a malicious user wanted to directly send a post request in order to alter/view information from the database.

  Storing Users
    Currently there is a list storing user/password combinations (containing 1 user) within the helper method "valid_user?". I chose not to export these logins to another file, nor encrypt them because I felt like it added uneeded complexity to the program since I was already fulfilling the project requirements. However, I know in an actual project, I would go the extra step.

  session[:next_path]
    Within the "check_sign_in" helper method, the users requested path is saved to session[:next_path]. This value is then later used in the "post /signin" route so that a user who tried to access a certain page will be redirected to that page once they have succesfully signed in. 

Error Messages/Handling
  Invalid Page Errors
    Initially, I wanted to redirect a user to the closest valid page from what they requested. So if they requested "/shops/4/products/2/edit", but there was no "product 2", then it would redirect them back to the "/shops/4" page. However, I realized that the only way a user would get to an out of bounds url was if they attempted to manually type it in(assuming I haven't created any bad paths to one), meaning that if a user requested "/shops/4/products/2/edit", they weren't necessarily in "/shops/4", but could've been anywhere in the application. So I decided to reroute all invalid page urls back to the main shops page instead. 

  Errors vs. Success
    Currently, errors are saved into an array and subsequently displayed from one. Success messages are saved and displayed as a single value. This is just because I found that there was a never a situation in which multiple success messages should be displayed at once.

  Extra 0's
    Currently, if you tried to add a new product with a price/cost that includes any number of 0's after the second decimal point (such as 12.5000), it will return an error even though it is potentially a valid input (since it could just be truncated down to 12.50). Checking for this would be a little troublesome with the current error detection methods. Additionally, a user entering a number like that could be mistaken on what the field is meant for (since it would be strange to enter a dollar amount with more than two decimal places).

Database Management
  Profit
    It would be ideal to be able to store an items profit value within the SQL database rather than generating it per page so I could ensure a consistent value. However, I just couldn't find out how to make a column in sql dependent on the values of other columns within the same table. I could have created a seperate table for profits that updates/etc. alongside the main products table, but that seemed overly complicated for what is just some basic subtraction that could be done in the view. 

    SQL query error detection
      The application does not currently check if an invalid SQL query was made. However, the application does do it's best to make sure that any information going into an SQL query is valid. The application does this with error detection methods when inputting information that will go into the database. The application also examines the results of an sql query (in methods like get_shop) to see if the result it returned was valid. 

      Notably, the application does not check at all if an sql query that attempts to delete (or edit although there are other protections for that as messaged before) data fails. This is because a user should not be able to delete a product/shop without a button to do so being generated. And that button should only be generated if the product/shop exists in the database. Application logic (like deleting products of a shop before the shop) should handle the rest. 

Shop id/product id/page #'s validation
  For my url validation methods that check if a page number/shop id/product id is non existant in the database, I chose to validate the url using the return value of the sql requests made for those page/shop/product numbers(which was made easier by the homogenous output of all my queries provided by ShopDatabase#format_result). 

  This method does result in a bit of awkward code organization(id prefer the validation methods to be at the top of the route), but saves me from performing a query to check if the id/page is in range, and another to display the information if it is. 

Pagination
  I chose to only incorporate links to the next or previous page, rather than incorporate links to go to specific page numbers because the size of the data sets I was working with made them feel uneeded. I think it would actually be rather easy to include numbered links to pages alongside the next/last page ones, but like other choices for this project, I wanted to keep it simple as long as it was functional.

Field limits for names/prices/costs
  Honestly, I just wasn't sure what good limitations for price or name length should be. So I just decided on some general limits. The only big logical flaw I could see with the limits I've placed is that production cost could be higher than sell price, but its not an improbable situation when managing a shop so I left it be. 

Tests
  I regret not writing tests for this project as they would've sped up some parts of the application creation proccess significantly. 

CSS
  I'm not the best at CSS and I wish I could've made the project look a lot nicer, but ultimately I just didn't want to spend any additional time during this project to learn more. Especially, because CSS was optional all together. 
